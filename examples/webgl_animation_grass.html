<!DOCTYPE html>
<html lang="en">
<head>
  <title>three.js webgl - 绿地</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <style>
    body {
      font-family: Monospace;
      background-color: #000;
      color: #000;
      margin: 0px;
      overflow: hidden;
    }

    #info {
      position: absolute;
      padding: 10px;
      width: 100%;
      text-align: center;
    }

    a {
      text-decoration: underline;
      cursor: pointer;
    }

  </style>
</head>

<body>
<div id="info">绿地<br/>
</div>

<script src="js/three.js"></script>
<script src="js/objects/Sky.js"></script>
<script src="js/controls/OrbitControls.js"></script>
<script src="js/loaders/VRMLLoader.js"></script>
<script src="js/libs/stats.min.js"></script>

<script>

  var container, stats;
  var camera, scene, renderer;
  var sky;

  init();
  animate();

  function init() {

    container = document.createElement('div');
    document.body.appendChild(container);

    // scene

    scene = new THREE.Scene();
    scene.background = new THREE.Color(0xcce0ff);
    // scene.background = new THREE.CubeTextureLoader()
    //   .setPath("assets/img/skybox/")
    //   .load(['px.jpg', 'nx.jpg', 'py.jpg', 'ny.jpg', 'pz.jpg', 'nz.jpg', ])

    // Add Sky
    sky = new THREE.Sky();
    sky.scale.setScalar( 40000 );
    scene.add( sky );

    // Add Sun Helper
    sunSphere = new THREE.Mesh(
      new THREE.SphereBufferGeometry( 20000, 16, 8 ),
      new THREE.MeshBasicMaterial( { color: 0xffffff } )
    );
    sunSphere.position.y = - 700000;
    sunSphere.visible = false;
    scene.add( sunSphere );

    // camera

    camera = new THREE.PerspectiveCamera(30, window.innerWidth / window.innerHeight, 1, 10000);
    camera.position.set(1000, 50, 1500);

    // lights

    scene.add(new THREE.AmbientLight(0x666666));

    var light = new THREE.DirectionalLight(0xdfebff, 1);
    light.position.set(50, 200, 100);
    light.position.multiplyScalar(1.3);

    light.castShadow = true;

    light.shadow.mapSize.width = 1024;
    light.shadow.mapSize.height = 1024;

    var d = 300;

    light.shadow.camera.left = -d;
    light.shadow.camera.right = d;
    light.shadow.camera.top = d;
    light.shadow.camera.bottom = -d;

    light.shadow.camera.far = 1000;

    scene.add(light);

    var VRMLLoader = new THREE.VRMLLoader();
    VRMLLoader.load('models/vrml/house.wrl', function (object) {

      object.scale.set(100, 100, 100);
      scene.add(object);

    });

    var loader = new THREE.TextureLoader();

    // ground

    var groundTexture = loader.load('textures/terrain/grasslight-big.jpg');
    groundTexture.wrapS = groundTexture.wrapT = THREE.RepeatWrapping;
    groundTexture.repeat.set(25, 25);
    groundTexture.anisotropy = 16;

    var groundMaterial = new THREE.MeshLambertMaterial({map: groundTexture});

    var mesh = new THREE.Mesh(new THREE.PlaneBufferGeometry(20000, 20000), groundMaterial);
    mesh.position.y = 0;
    mesh.rotation.x = -Math.PI / 2;
    mesh.receiveShadow = true;
    scene.add(mesh);

    // renderer

    renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);

    container.appendChild(renderer.domElement);

    renderer.gammaInput = true;
    renderer.gammaOutput = true;

    renderer.shadowMap.enabled = true;

    // controls
    var controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.maxPolarAngle = Math.PI * 0.5;
    controls.minDistance = 1000;
    controls.maxDistance = 5000;

    // performance monitor

    stats = new Stats();
    container.appendChild(stats.dom);

    //

    window.addEventListener('resize', onWindowResize, false);

  }

  //

  function onWindowResize() {

    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();

    renderer.setSize(window.innerWidth, window.innerHeight);

  }

  //

  function animate() {

    requestAnimationFrame(animate);

    render();
    stats.update();

  }

  function render() {

    renderer.render(scene, camera);

  }

</script>
</body>
</html>
