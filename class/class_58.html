<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>射线绑定事件</title>

    <script src="../js/threejs/three.js"></script>

    <style>
        html, body{
            margin: 0;
            height: 100%;
        }

        canvas {
            display: block;
        }
    </style>

</head>
<body onload="draw();">
    
</body>

<script src="../js/threejs/OrbitControls.js"></script>
<script src="../js/threejs/Stats.js"></script>
<script src="../js/threejs/dat.gui.js"></script>

<script>

    var renderer;

    function initRender() {

        renderer = new THREE.WebGLRenderer({antialias: true, alpha:true});

        renderer.setClearColor(new THREE.Color(0xEEEEEE)); //设置背景颜色

        renderer.setSize(window.innerWidth, window.innerHeight);

        document.body.appendChild(renderer.domElement);

    }

    var camera;

    function initCamera() {

        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 10000);

        camera.position.set(0, 40, 100);

        camera.lookAt(new THREE.Vector3(0, 0, 0));

    }

    var scene;

    function initScene() {

        scene = new THREE.Scene();

    }

    var light;

    function initLight() {

        

    }


    function initModel() {

        //轴辅助 （每一个轴的长度）

        var helper = new THREE.AxesHelper(1000);

        scene.add(helper);

        var s = 25;

        var cube = new THREE.CubeGeometry(s, s, s);

        for (var i = 0; i < 3000; i++) {

            var material = new THREE.MeshBasicMaterial({color:randomColor()});

            var mesh = new THREE.Mesh(cube, material);

            mesh.position.x = 800 * ( 2.0 * Math.random() -1.0 );

            mesh.position.y = 800 * ( 2.0 * Math.random() -1.0 );

            mesh.position.z = 800 * ( 2.0 * Math.random() -1.0 );

            mesh.rotation.x = Math.random() * Math.PI;

            mesh.rotation.y = Math.random() * Math.PI;

            mesh.rotation.z = Math.random() * Math.PI;

            mesh.updateMatrix();

            scene.add(mesh);

        }

    }

    //随机颜色

    function randomColor() {

        var arrHex = ["0","1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d","e","f"],

        strHex = "#",

        index;

        for (var i = 0; i < 6; i++) {

            index = Math.round(Math.random() * 15);

            strHex += arrHex[index];

        }

        return strHex;

    }

    //声明raycaster和mouse变量

    var raycaster = new THREE.Raycaster();

    var mouse = new THREE.Vector2();

    function onMouseClick (event) {

        //通过鼠标点击的位置计算出raycaster所需要的点的位置，以屏幕中心为原点，值的范围为-1到1。

        mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;

        mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

        //通过鼠标点的位置和当前相机的矩阵计算出raycaster

        raycaster.setFromCamera( mouse, camera );

        //获取raycaster直线和所有模型相交的数组集合

        var intersects = raycaster.intersectObjects( scene.children );

        console.log( intersects );

        //将所有的相交模型的颜色设置为红色，如果只需将第一个触发事件，那就将数组的第一个模型改变颜色即可

        for ( var i = 0; i < intersects.length; i++ ) {

            intersects[i].object.material.color.set( 0xff0000 );

        }

    }

    window.addEventListener( 'click', onMouseClick, false );

    //初始化性能插件

    var stats;

    function initStats() {

        stats = new Stats();

        document.body.appendChild(stats.domElement);

    }

    //用户交互插件 鼠标左键按住旋转，右键按住平移，滚轮缩放

    var controls;

    function initControls() {

        controls = new THREE.OrbitControls(camera, renderer.domElement);

        // 如果使用animate方法时，将此函数删除

        //controls.addEventListener( 'change', render );

        // 使动画循环使用时阻尼或自转 意思是否有惯性

        controls.enableDamping = true;

        //动态阻尼系数 就是鼠标拖拽旋转灵敏度

        //controls.dampingFactor = 0.25;

        //是否可以缩放

        controls.enableZoom = true;

        //是否自动旋转

        controls.autoRotate = false;

        //设置相机距离原点的最远距离

        controls.minDistance = 20;

        //设置相机距离原点的最远距离

        controls.maxDistance = 10000;

        //是否开启右键拖拽

        controls.enablePan = true;

    }

    //生成gui设置配置项

    var gui;

    function initGui() {

        //声明一个保存需求修改的相关数据的对象

        gui = {


        };

        var datGui = new dat.GUI();

    }

    function render() {

        renderer.render(scene, camera);

    }

 
    //窗口变动触发的函数

    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;

        camera.updateProjectionMatrix();

        render();

        renderer.setSize(window.innerWidth, window.innerHeight);

    }

    function animate() {

        //更新性能插件

        // stats.update();

        //更新控制器

        controls.update();

        render();

        requestAnimationFrame(animate);

    }

    function draw() {

        initRender();

        // initStats();

        initScene();

        initCamera();

        initLight();

        initModel();

        initControls();

        initGui();

        animate();

        window.onresize = onWindowResize;

    }

</script>

</html>